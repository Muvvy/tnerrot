<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Раздача</title>
</head>
<body>
  <h1>Информация о раздаче</h1>
  <div id="torrent"></div>
  <button onclick="watch()">▶ Смотреть</button>
  <div id="player"></div>
  <script>
    const infoHash = location.pathname.split('/').pop();
    const urlParams = new URLSearchParams(window.location.search);
    const query = urlParams.get('q') || '';

    fetch(`/torrent/${infoHash}?q=${encodeURIComponent(query)}`)
      .then(res => res.json())
      .then(torrent => {
        const div = document.getElementById('torrent');
        div.innerHTML = `
          <b>${torrent.title}</b><br>
          Размер: ${torrent.size}<br>
          Сиды: ${torrent.seeders}, Личи: ${torrent.leechers}<br>
          <a href="${torrent.magnetLink}">Magnet</a>
        `;
      })
      .catch(() => {
        document.getElementById('torrent').innerText = 'Ошибка загрузки информации о раздаче';
      });

    function watch() {
      if (!query) {
        alert('Не указан запрос (название фильма). Вернитесь и выполните поиск заново.');
        return;
      }
      document.getElementById('player').innerHTML = `
        <video controls autoplay width="720" src="/stream/${infoHash}?q=${encodeURIComponent(query)}"></video>
      `;
    }
  </script>
</body>
</html>
